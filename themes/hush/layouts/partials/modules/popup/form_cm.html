{{$formSettings := .Site.Params.formSetting}}
<div class="sendRequest__wrapper">
  {{with $formSettings.formtitle}}
    <div class="sitePopup__content__title">
      <p>{{.}}</p>
    </div>
  {{end}}
  {{with $formSettings.formdescription}}
  <div class="sitePopup__content__description">
    <p>{{.}}</p>
  </div>
  {{end}}
    <form id="subForm" class="sendRequest getLocation js-cm-form" action="{{$formSettings.actionurl}}" method="post" data-id="2BE4EF332AA2E32596E38B640E905619D20C67A0F7EA9CAEB3132DC245B61BA75CD68FBABB3D0E7A7B95782446EAA3B4032BBEB996145903ADA5B97052EB32DA">
    {{with $formSettings.yourname}}
      <input type="text" name="{{$formSettings.yournameinputname}}"
        class="sendRequest__input yourname" value="" placeholder="{{.}}">
    {{end}}
    {{with $formSettings.whenareyouthinkingstring}}
      <select name="{{$formSettings.whenareyouthinkinginputname}}" class="sendRequest__input">
        <option value="" disabled selected hidden>{{.}}</option>
        {{with $formSettings.whenareyouthinkingoptions}}
          {{. | safeHTML}}
        {{end}}
      </select>
    {{end}}
    {{with $formSettings.howmanypeoplestring}}
      <select name="{{$formSettings.howmanypeopleinputname}}" class="sendRequest__input">
        <option value="" disabled selected hidden>{{.}}</option>
        {{with $formSettings.howmanypeopleoptions}}
          {{. | safeHTML}}
        {{end}}
      </select>
    {{end}}
    {{with $formSettings.emailstring}}
      <input type="email" name="{{$formSettings.emailinputname}}"
        class="sendRequest__input js-cm-email-input" value="" placeholder="{{.}}">
    {{end}}
    {{with $formSettings.pleasesendmeabrochurestring}}
      <div class="sendRequest__radio">
        <input type="checkbox" name="{{$formSettings.pleasesendmeabrochureinputname}}"
          value="{{$formSettings.pleasesendmeabrochureyesvalue}}" checked="checked"
          data-yes="{{$formSettings.pleasesendmeabrochureyesvalue}}"
          data-no="{{$formSettings.pleasesendmeabrochurenovalue}}"
          id="brochureInput">
        <label><p>{{.}}</p>
        <div></div></label>
      </div>
    {{end}}
    {{with $formSettings.message}}
      <textarea name="{{$formSettings.messageinputname}}" class="sendRequest__input" placeholder="{{.}}"></textarea>
    {{end}}
    {{with $formSettings.pleaseaddmetoyourmailingliststring}}
      <div class="sendRequest__radio">
        <input type="checkbox" name="{{$formSettings.pleaseaddmetoyourmailinglistinputname}}">
        <label><p>{{.}}</p>
        <div></div></label>
      </div>
    {{end}}
    {{with $formSettings.formversioninputname}}
      <input type="text" name="{{.}}" value="{{$formSettings.formversionvalue}}" hidden="hidden">
    {{end}}
    {{with $formSettings.buttonidinputname}}
      <input type="text" name="{{.}}" value="" id="buttonidinputname" hidden="hidden">
    {{end}}
    {{with $formSettings.hashtaginputname}}
      <input type="text" name="{{.}}" value="" id="hashtaginputname" hidden="hidden">
      <script type="text/javascript">
        if(window.location.hash) {
          var hash = window.location.hash.substring(1),
            now = new Date();
          now.setTime(now.getTime() + 20000);
          document.cookie = "_hashtaginputname=" + hash + "; expires=" + now.toUTCString() + "; path=/";
        }
      </script>
    {{end}}
    {{with $formSettings.liststatusinputname}}
      <input type="text" name="{{.}}" value="{{$formSettings.liststatusvalue}}" hidden="hidden">
    {{end}}
    {{with $formSettings.getuserlocation}}
      <input type="text" name="{{$formSettings.getuserlocationfieldname}}" id="getuserlocation" value="" hidden="hidden">
    {{end}}
    {{with $formSettings.okaystring}}
      <button type="submit" name="button" class="sendRequest__submit js-cm-submit-button">{{.}}</button>
    {{end}}
    {{with $formSettings.privacypolicystring}}
      <p class="sendRequest__copyright">{{$formSettings.yourprivacyiskeystring}}
        <a href="{{$formSettings.privacypolicylink}}" target="_blank">{{.}}</a></p>
    {{end}}
  </form>
  <script type="text/javascript">
	!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){var n;"function"!=typeof(n=window.Element?window.Element.prototype:window.HTMLElement.prototype).matches&&(n.matches=n.msMatchesSelector||n.mozMatchesSelector||n.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=0;t[n]&&t[n]!==this;)++n;return Boolean(t[n])}),"function"!=typeof n.closest&&(n.closest=function(e){for(var t=this;t&&1===t.nodeType;){if(t.matches(e))return t;t=t.parentNode}return null}),function(){var e,t,n,o=document.documentElement||document.body;o.getAttribute("data-cm-hook")||(t="submit",n=function(e){var t=e.target.closest(".js-cm-form");t&&(e.preventDefault?e.preventDefault():e.returnValue=!1,function(e,t,n){var o=n.querySelector(".js-cm-email-input"),r="email="+encodeURIComponent(o.value)+"&data="+encodeURIComponent(n.getAttribute("data-id")),u=new XMLHttpRequest;u.onreadystatechange=function(){if (this.readyState === 4) {
		if (this.status === 200) {
		// Having token and new submit url we can create new request to subscribe a user.
		
		subscribeRequest = new XMLHttpRequest();
		subscribeRequest.open('POST', this.responseText, true);
		subscribeRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		subscribeRequest.send($("#subForm").serialize());
		// On ready state call response function.
		subscribeRequest.onreadystatechange = function() {
			if (this.readyState === 4) {
			  if (this.status === 200) {
				
				if (jQuery( this.response ).find('.g-recaptcha').length) {
					form_id = jQuery('#subForm').attr('data-id');
					email = jQuery(".js-cm-email-input");
					request_data = "email=" + encodeURIComponent(email.value) + "&data=" + form_id;
					// Prepare tokenRequest.
					tokenRequest = new XMLHttpRequest();
					tokenRequest.open('POST', 'https://createsend.com//t/getsecuresubscribelink', true);
					tokenRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					tokenRequest.send(request_data);
					tokenRequest.onreadystatechange = function() {
						n.action=this.responseText,
						n.submit();
					}
					
				}
				else {
					jQuery('.sendRequest__wrapper').hide();
					jQuery('.sitePopup__content__thankU').addClass('active');
				}
			  } else {
				console.log(this.readyState);
			  }
			}
		}
		} else {
		alert("error");
		}
	}},u.open(e,t,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.send(r)}("POST","https://createsend.com/t/getsecuresubscribelink",t))},(e=o).addEventListener?e.addEventListener(t,n):e.attachEvent("on"+t,n),o.setAttribute("data-cm-hook","1"))}()},function(e,t,n){e.exports=n(0)}]);
  </script>
  {{with $formSettings.utmprefences}}
    {{. | safeHTML}}
    <script src="https://d12ue6f2329cfl.cloudfront.net/resources/utm_form-1.0.2.min.js"></script>
  {{end}}
</div>
